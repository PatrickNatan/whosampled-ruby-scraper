var WS=WS||{};WS.REGEX_EMAIL=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;WS.getCookie=function(name){let cookieValue=null;if(document.cookie&&document.cookie!==''){const cookies=document.cookie.split(';');for(let cookie of cookies){cookie=cookie.trim();if(cookie.substring(0,name.length+1)==(name+'=')){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break;}}}
return cookieValue;};WS.sendPOST=async function(url,payload){const response=await fetch(url,{'method':'POST','credentials':'same-origin','body':payload,'headers':{'X-CSRFToken':WS.getCookie('csrftoken')}});if(!response.ok){throw new Error(`${response.status} ${response.statusText}`);}
const data=await response.json();return{'data':data,'status':response.status};};$.ajaxSetup({crossDomain:false,beforeSend:function(xhr,settings){if(!(/^(GET|HEAD|OPTIONS|TRACE)$/.test(settings.type))){xhr.setRequestHeader("X-CSRFToken",WS.getCookie('csrftoken'));}}});(function($){$.fn.autocomplete=function(options){var settings=$.extend({dropdown:null,delay:400,minChars:1,success:null,onItemSelected:null,maxItems:10,fillInput:true,extraParams:{},showDropdownOnFocus:false,autoDropdownPosition:true,imgWidth:50,imgHeight:50,},options);this.each(function(){var input=$(this);var dropdown=settings.dropdown;var dropdownHover=false;var inputHover=false;input.attr('spellcheck','false');input.attr('autocomplete','off');if(!dropdown){dropdown=$('<div class="dropdown"><ul></ul></div>');dropdown.css('position','absolute');dropdown.hide();$('#container').append(dropdown);}
function fillInputWithItem(item){input.val(item.find('p span.mainRow').text());input.blur().focus().val(input.val());showDropdown(dropdown,false,true);}
function nextItem(dir){var el=dropdown.find('.searchResult.selected');if(el.length){el.removeClass('selected');var next=null;if(dir>0){next=el.next();}else{next=el.prev();}
if(!next.length){el=el.parent().parent();if(dir>0){el=el.next();}else{el=el.prev();}
el=el.find('.searchResult');if(dir>0){el=el.first();}else{el=el.last();}}else{el=next;}}else{el=dropdown.find('.searchResult');if(dir>0){el=el.first();}else{el=el.last();}}
el.addClass('selected');}
function handleSelectionKeydown(evt){switch(evt.keyCode){case 27:showDropdown(dropdown,false,true);break;case 38:nextItem(-1);break;case 40:nextItem(1);break;case 13:var item=dropdown.find('.searchResult.selected');if(item.length){if(settings.fillInput){fillInputWithItem(item);}
if(settings.onItemSelected){settings.onItemSelected(item,item.find('span.mainRow').text());}
return false;}
break;}}
function hideOtherDropdowns(){$('.dropdown').each(function(){if($(this)[0]!=dropdown[0]){showDropdown($(this),false,true);}});}
function showDropdown(dropdownElement,show,animated,complete){if(show){if(settings.autoDropdownPosition){if(dropdownElement[0]==dropdown[0]&&input.length){dropdownElement.css('top',input.offset().top-$('#container').offset().top+input.outerHeight());dropdownElement.css('left',input.offset().left-$('#container').offset().left);}
dropdownElement.css('width',input.outerWidth()-2);}
hideOtherDropdowns();if(animated){dropdownElement.fadeIn(150,complete);}else{dropdownElement.show();}}else{if(animated){dropdownElement.fadeOut(150,complete);}else{dropdownElement.hide();}}
if(show){input.unbind('keydown.autocomplete',handleSelectionKeydown);input.bind('keydown.autocomplete',handleSelectionKeydown);dropdownElement.find('.searchResult').click(function(){var item=$(this);if(settings.fillInput){fillInputWithItem(item);}
if(settings.onItemSelected){settings.onItemSelected(item,item.find('span.mainRow').text());}
return false;});}else{input.unbind('keydown.autocomplete',handleSelectionKeydown);var items=dropdownElement.find('.searchResult');items.removeClass('selected');}}
var xhr=null;function performSearch(force){var val=input.val();if(!force&&val.length<1){showDropdown(dropdown,false,true);return false;}
input.addClass('loading');if(xhr){xhr.abort();xhr=null;}
xhr=$.ajax({url:settings.url+'?q='+$.trim(encodeURIComponent(val)),data:settings.extraParams,cache:false,success:function(data){input.removeClass('loading');if(settings.success){settings.success(data);}else{var list=dropdown.find('ul');list.find('li').remove();for(var i in data){if(i>=settings.maxItems)break;var item=data[i];var html;html='<li class="searchResult"><a href="'+item.url+'">';if(item.image_url){html+='<img src="'+item.image_url+'" width="'+settings.imgWidth+'" height="'+settings.imgHeight+'" />';}
html+='<p><span class="mainRow">'+item.name+'</span>';if(item.counts){html+='<span class="countsRow">'+item.counts+'</span>';}
if(item.id){html+='<input type="hidden" value="'+item.id+'" />';}
html+='</p></a></li>';list.append(html);}}
showDropdown(dropdown,true,true);}});}
input.bind('input.autocomplete propertychange.autocomplete',function(e){if(e.type=='propertychange'&&e.originalEvent.propertyName!='value'){return false;}
if(input.val()==input.attr('placeholder')){return false;}
clearTimeout($.data(this,'timer'));if(input.val().length<settings.minChars){showDropdown(dropdown,false,true,function(){var list=dropdown.find('ul');list.find('li').remove();});input.removeClass('loading');return true;}
hideOtherDropdowns();if(input.val().length>=settings.minChars){input.addClass('loading');$(this).data('timer',setTimeout(performSearch,settings.delay));}});if(settings.showDropdownOnFocus){input.focus(function(){if(input.val().length>=settings.minChars&&dropdown.find('ul li').length>0){showDropdown(dropdown,true,false);}});}
dropdown.hover(function(){dropdownHover=true;},function(){dropdownHover=false;});input.bind('mouseenter.autocomplete',function(){inputHover=true;});input.bind('mouseleave.autocomplete',function(){inputHover=false;});input.bind('blur.autocomplete',function(){if(!dropdownHover){showDropdown(dropdown,false,true);clearTimeout($.data(this,'timer'));$(this).removeClass('loading');if(xhr){xhr.abort();xhr=null;}}});input.bind('keydown.autocomplete',function(e){if(e.keyCode==40){if(dropdown.find('.searchResult').length>0){showDropdown(dropdown,true,true);}
return false;}});$('html').click(function(){if(!inputHover){showDropdown(dropdown,false,true);}});dropdown.click(function(e){e.stopPropagation();return true;});});};})(jQuery);$(function(){$('.searchInput').autocomplete({dropdown:$('#searchDropdown'),url:'/ajax/search/',fillInput:false,showDropdownOnFocus:true,success:function(data){var i;var artists=$('#searchArtists');var tracks=$('#searchTracks');var movies=$('#searchMovies');var tv_shows=$('#searchTVShows');if(data.artists.length>0){artists.show();}else{artists.hide();}
if(data.tracks.length>0){tracks.show();}else{tracks.hide();}
if(data.movies.length>0){movies.show();}
else{movies.hide();}
if(data.tv_shows.length>0){tv_shows.show();}
else{tv_shows.hide();}
var artistsList=artists.find('ul');var tracksList=tracks.find('ul');var moviesList=movies.find('ul');var tvShowsList=tv_shows.find('ul');var artist;var html;var track;var movie;var tv_show;artistsList.find('li').remove();for(i in data.artists){artist=data.artists[i];html='<li class="searchResult"><a href="'+artist.url+'"><img src="'+artist.image_url+'" width="50" height="50" /><p><span class="mainRow">'+artist.artist_name+'</span><span class="countsRow">'+artist.counts+'</span></p></a></li>';artistsList.append(html);}
tracksList.find('li').remove();for(i in data.tracks){track=data.tracks[i];html='<li class="searchResult"><a href="'+track.url+'"><img src="'+track.image_url+'" width="50" height="50" /><p><span class="mainRow">'+track.track_name+'</span><span class="countsRow">'+track.artist_name+'</span></p></a></li>';tracksList.append(html);}
moviesList.find('li').remove();for(i in data.movies){movie=data.movies[i];html='<li class="searchResult visualMediaResult"><a href="'+movie.url+'"><img src="'+movie.image_url+'" width="50" height="70" /><p><span class="mainRow">'+movie.movie_name+'</span><span class="countsRow">'+movie.release_year+'</span></p></a></li>';moviesList.append(html);}
tvShowsList.find('li').remove();for(i in data.tv_shows){tv_show=data.tv_shows[i];html='<li class="searchResult visualMediaResult"><a href="'+tv_show.url+'"><img src="'+tv_show.image_url+'" width="50" height="70" /><p><span class="mainRow">'+tv_show.tvshow_name+'</span><span class="countsRow">TV Show</span></p></a></li>';tvShowsList.append(html);}
$('.searchResult').unbind('mouseenter mouseleave');$('.searchResult').hover(function(){$('.searchResult').removeClass('selected');$(this).addClass('selected');});},onItemSelected:function(el){window.location=el.find('a').attr('href');}});if(document.createElement('input').placeholder===undefined){$('input[placeholder]').each(function(){var el=$(this);var placeholder=el.attr('placeholder');el.focus(function(){if(el.val()==placeholder){el.val('');}});el.blur(function(){if(el.val()===''){el.val(placeholder);}});el.val(placeholder);});}
$('.searchForm').submit(function(){if($.trim($(this).find('.searchInput').val()).length===0){$(this).find('.searchInput').focus();return false;}
return true;});function setDropdownExpanded(menu,expanded){var items;items=menu.find('li');if(expanded){items.show();menu.data('defaultOption').removeClass('activeOption').css('display','list-item');menu.data('defaultOption').addClass('selected');menu.find('ul').css('position','absolute');menu.find('ul').addClass('expanded');menu.find('li a, li span.item').unbind('mouseenter mouseleave');menu.find('li a, li span.item').hover(function(){menu.find('li').not($(this).parent()).removeClass('selected');$(this).parent().addClass('selected');});if(menu.hasClass('select')){menu.find('li a').on('click touchstart',function(evt){if(menu.data('defaultOption')[0]!=$(this).parent()[0]){menu.data('defaultOption',$(this).parent());menu.trigger('change',$(this).parent().attr('data-value'));}
setDropdownExpanded(menu,false);evt.stopPropagation();return false;});}
menu.mouseleave(function(){menu.find('ul li').removeClass('selected');menu.data('defaultOption').addClass('selected');});}else{items.hide();menu.data('defaultOption').addClass('activeOption');menu.data('defaultOption').show();menu.find('ul').css('position','static');menu.find('ul').removeClass('expanded');menu.unbind('mouseleave');menu.find('li a, li span.item').unbind('click touchstart mouseenter mouseleave');menu.find('ul li').removeClass('selected');}}
$('.optionMenu').each(function(){var menu=$(this);var minWidth=0;var maxWidth=400;menu.data('defaultOption',menu.find('li.activeOption'));$('html').on('click touchstart',function(){setDropdownExpanded(menu,false);});menu.find('ul li').each(function(){var width=$(this).width();if(minWidth<width){minWidth=width;}});if(minWidth<maxWidth){menu.css('min-width',minWidth);}
menu.on('click touchstart',function(e){var expanded=$(this).find('ul').hasClass('expanded');if(!expanded){var clickedMenu=$(this);$('.optionMenu').each(function(){if($(this).find('ul').hasClass('expanded')&&$(this)!=clickedMenu){setDropdownExpanded($(this),false);}});setDropdownExpanded($(this),true);return false;}
e.stopPropagation();});setDropdownExpanded($(this),false);});if($('#commentForm').length){$('#commentForm').submit(function(){var text;$('#btnSubmitComment').attr('disabled',true);text=$.trim($('#id_discussion_item').val());if(text.length===0){$('#id_discussion_item').focus();return false;}});if($('#id_discussion_item').val()){if($('#id_discussion_item').val().length>0){$('#id_discussion_item').focus();}}}
$('.okMsg, .errorMsg').each(function(){var closeButton=$('<button class="closeButton"></button>');var msg=$(this);closeButton.click(function(){msg.slideUp();});msg.append(closeButton);});$('.downloadButton').click(function(evt){var dropdown=$('#'+$(this).attr('id').replace('Button','Dropdown'));dropdown.width($(this).innerWidth()-1);dropdown.css('position','absolute');dropdown.toggle();evt.stopPropagation();return false;});$('#editArtist').on('click',function(evt){evt.preventDefault();toggleDiv('#editArtistLinks',this);$('.editArtistContainer').toggleClass('active');});$('li a img').hover(function(){$(this).closest('li').find('a:not(a:has(img))').first().addClass('active');},function(){$(this).closest('li').find('a:not(a:has(img))').first().removeClass('active');});});function toggleDiv(div_name,link){$(div_name).toggle("fast",function(){link=$(link);if($(div_name).is(':visible')){link.addClass('active');}else{link.removeClass('active');}});return false;}
function hideDiv(div_name,link){$(div_name).hide("fast",function(){link=$(link);if($(div_name).is(':visible')){link.addClass('active');}else{link.removeClass('active');}});return false;}
function showDiv(div_name,link){$(div_name).show("fast",function(){link=$(link);if($(div_name).is(':visible')){link.addClass('active');}else{link.removeClass('active');}});return false;}